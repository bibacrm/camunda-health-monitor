<div x-show="activeTab === 'trends'" x-transition>
    <!-- Complete Version History Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-6"
         x-intersect.once="!versionHistory && !versionHistoryLoading && loadVersionHistory()">
        <div class="flex items-center justify-between mb-4">
            <div class="font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                <i data-lucide="git-branch"
                   class="mr-2 h-5 w-5 text-purple-600 dark:text-purple-400"></i>
                <span>Complete Version Performance History</span>
                <span class="group relative ml-2">
                                <i data-lucide="info" class="h-4 w-4 text-gray-400 cursor-help"></i>
                                <span class="hidden group-hover:block absolute left-0 top-6 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl z-50">
                                    Tracks performance across ALL deployed versions (not just latest 2). Identifies regression patterns and helps make informed rollback decisions.
                                </span>
                            </span>
                <span class="ml-2 text-xs px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full font-semibold">
                                ALL VERSIONS
                            </span>
            </div>
            <button @click="loadVersionHistory()"
                    :disabled="versionHistoryLoading"
                    class="inline-flex items-center px-4 py-2 border border-purple-300 dark:border-purple-600 shadow-sm text-sm font-medium rounded-md text-purple-700 dark:text-purple-300 bg-white dark:bg-gray-800 hover:bg-purple-50 dark:hover:bg-purple-900/30 disabled:opacity-50">
                <i data-lucide="refresh-cw" class="h-4 w-4 mr-2"
                   :class="{ 'animate-spin': versionHistoryLoading }"></i>
                <span x-text="versionHistoryLoading ? 'Loading...' : 'Refresh'"></span>
            </button>
        </div>

        <template x-if="versionHistoryLoading">
            <div class="flex flex-col items-center justify-center py-8">
                <div class="loader mb-2"></div>
                <p class="text-xs text-gray-600 dark:text-gray-400">Loading version history...</p>
            </div>
        </template>

        <template x-if="versionHistory && !versionHistoryLoading">
            <div>
                <div class="mb-4 p-3 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg border border-purple-200 dark:border-purple-800">
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Processes
                                Tracked</p>
                            <p class="text-lg font-bold text-gray-900 dark:text-gray-100"
                               x-text="versionHistory.total_processes || 0"></p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Regressions
                                Found</p>
                            <p class="text-lg font-bold text-red-600 dark:text-red-400"
                               x-text="versionHistory.regression_count || 0"></p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Improvements</p>
                            <p class="text-lg font-bold text-green-600 dark:text-green-400"
                               x-text="versionHistory.improvement_count || 0"></p>
                        </div>
                    </div>
                </div>

                <!-- Regressions (if any) -->
                <template
                        x-if="versionHistory.regressions && versionHistory.regressions.length > 0">
                    <div class="mb-4">
                        <h4 class="text-sm font-semibold text-red-600 dark:text-red-400 mb-2">
                            ðŸš¨ Critical Regressions
                        </h4>
                        <div class="space-y-2">
                            <template x-for="reg in versionHistory.regressions.slice(0, 5)"
                                      :key="reg.process_key">
                                <div class="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                                    <div class="flex items-start justify-between mb-2">
                                        <div class="flex-1">
                                            <p class="font-medium text-gray-900 dark:text-gray-100"
                                               x-text="reg.process_key"></p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
                                                v<span x-text="reg.previous_version"></span> â†’
                                                v<span
                                                    x-text="reg.latest_version"></span>
                                                <span class="ml-2 font-bold text-red-600 dark:text-red-400"
                                                      x-text="'(' + reg.change_pct.toFixed(1) + '% slower)'"></span>
                                            </p>
                                        </div>
                                        <span class="text-xs px-2 py-1 rounded-full font-semibold uppercase"
                                              :class="{
                                                              'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400': reg.severity === 'critical',
                                                              'bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400': reg.severity === 'high'
                                                          }"
                                              x-text="reg.severity"></span>
                                    </div>
                                    <p class="text-xs text-red-700 dark:text-red-300 mb-2"
                                       x-text="reg.recommendation"></p>
                                    <template x-if="reg.sample_instance_id">
                                        <div class="text-xs bg-white dark:bg-gray-800 p-2 rounded border border-red-200 dark:border-red-800">
                                            <div class="mb-1">
                                                <span class="text-gray-500 dark:text-gray-400">Sample: </span>
                                                <code class="text-gray-900 dark:text-gray-100"
                                                      x-text="reg.sample_instance_id"></code>
                                            </div>
                                            <div x-show="reg.sample_business_key">
                                                <span class="text-gray-500 dark:text-gray-400">BKey: </span>
                                                <span class="text-gray-900 dark:text-gray-100"
                                                      x-text="reg.sample_business_key"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

                <!-- Version Comparisons -->
                <div class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                    <template
                            x-for="comp in (versionHistory.version_comparisons || []).slice(0, 10)"
                            :key="comp.process_key">
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                            <div class="p-3 bg-gray-50 dark:bg-gray-900/50 flex items-center justify-between cursor-pointer"
                                 @click="comp.expanded = !comp.expanded; $nextTick(() => lucide.createIcons())">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <p class="font-medium text-gray-900 dark:text-gray-100"
                                           x-text="comp.process_key"></p>
                                        <span class="text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded"
                                              x-text="comp.all_versions_count + ' versions'"></span>
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-gray-600 dark:text-gray-400">
                                                            <span>Latest: v<span
                                                                    x-text="comp.latest_version"></span></span>
                                        <span>â†’</span>
                                        <span :class="{
                                                        'text-red-600 dark:text-red-400 font-semibold': comp.direction === 'regression',
                                                        'text-green-600 dark:text-green-400 font-semibold': comp.direction === 'improvement'
                                                    }"
                                              x-text="comp.change_pct > 0 ? '+' + comp.change_pct.toFixed(1) + '%' : comp.change_pct.toFixed(1) + '%'"></span>
                                    </div>
                                </div>
                                <i data-lucide="chevron-down"
                                   class="h-4 w-4 text-gray-400 transition-transform"
                                   :class="{ 'rotate-180': comp.expanded }"></i>
                            </div>
                            <div x-show="comp.expanded" x-collapse>
                                <div class="p-3 bg-white dark:bg-gray-800">
                                    <template
                                            x-if="comp.all_versions && comp.all_versions.length > 0">
                                        <table class="min-w-full text-xs">
                                            <thead>
                                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                                <th class="text-left py-2 text-gray-500 dark:text-gray-400">
                                                    Version
                                                </th>
                                                <th class="text-right py-2 text-gray-500 dark:text-gray-400">
                                                    Instances
                                                </th>
                                                <th class="text-right py-2 text-gray-500 dark:text-gray-400">
                                                    Avg
                                                </th>
                                                <th class="text-right py-2 text-gray-500 dark:text-gray-400">
                                                    P95
                                                </th>
                                                <th class="text-left py-2 text-gray-500 dark:text-gray-400">
                                                    Sample
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <template x-for="(v, vidx) in comp.all_versions"
                                                      :key="vidx">
                                                <tr class="border-b border-gray-100 dark:border-gray-700/50">
                                                    <td class="py-2">
                                                                    <span class="font-medium text-gray-900 dark:text-gray-100"
                                                                          x-text="'v' + v.version"></span>
                                                        <span x-show="vidx === 0"
                                                              class="ml-1 text-xs px-1 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded">Current</span>
                                                    </td>
                                                    <td class="py-2 text-right text-gray-900 dark:text-gray-100"
                                                        x-text="v.count?.toLocaleString()"></td>
                                                    <td class="py-2 text-right text-gray-900 dark:text-gray-100"
                                                        x-text="formatDuration(v.avg_s * 1000)"></td>
                                                    <td class="py-2 text-right text-gray-900 dark:text-gray-100"
                                                        x-text="formatDuration(v.p95_s * 1000)"></td>
                                                    <td class="py-2">
                                                        <code x-show="v.sample_instance_id"
                                                              class="text-xs bg-gray-100 dark:bg-gray-700 px-1 rounded text-gray-900 dark:text-gray-100"
                                                              x-text="(v.sample_instance_id || '').substring(0, 50)"></code>
                                                    </td>
                                                </tr>
                                            </template>
                                            </tbody>
                                        </table>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </template>
    </div>

    <!-- NEW: Weekly Load Patterns Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-6"
         x-intersect.once="!weeklyLoadPatterns && !weeklyLoadPatternsLoading && loadWeeklyLoadPatterns()">
        <div class="flex items-center justify-between mb-4">
            <div class="font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                <i data-lucide="calendar"
                   class="mr-2 h-5 w-5 text-indigo-600 dark:text-indigo-400"></i>
                <span>Weekly Load Patterns</span>
                <span class="group relative ml-2">
                                <i data-lucide="info" class="h-4 w-4 text-gray-400 cursor-help"></i>
                                <span class="hidden group-hover:block absolute left-0 top-6 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl z-50">
                                    Shows process instance distribution across weekdays. Helps identify peak days for capacity planning and optimal scheduling of batch jobs and maintenance windows.
                                </span>
                            </span>
                <span class="ml-2 text-xs px-2 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400 rounded-full font-semibold">
                                CAPACITY PLANNING
                            </span>
            </div>
            <button @click="loadWeeklyLoadPatterns()"
                    :disabled="weeklyLoadPatternsLoading"
                    class="inline-flex items-center px-4 py-2 border border-indigo-300 dark:border-indigo-600 shadow-sm text-sm font-medium rounded-md text-indigo-700 dark:text-indigo-300 bg-white dark:bg-gray-800 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 disabled:opacity-50">
                <i data-lucide="refresh-cw" class="h-4 w-4 mr-2"
                   :class="{ 'animate-spin': weeklyLoadPatternsLoading }"></i>
                <span x-text="weeklyLoadPatternsLoading ? 'Loading...' : 'Refresh'"></span>
            </button>
        </div>

        <template x-if="weeklyLoadPatternsLoading">
            <div class="flex flex-col items-center justify-center py-8">
                <div class="loader mb-2"></div>
                <p class="text-xs text-gray-600 dark:text-gray-400">Loading weekly patterns...</p>
            </div>
        </template>

        <template x-if="weeklyLoadPatterns && !weeklyLoadPatternsLoading">
            <div>
                <!-- Summary Stats -->
                <div class="mb-4 p-3 bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 rounded-lg border border-indigo-200 dark:border-indigo-800">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-center">
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Analysis Period</p>
                            <p class="text-lg font-bold text-gray-900 dark:text-gray-100"
                               x-text="weeklyLoadPatterns.analysis_window_days + ' days'"></p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Business Days
                                Load</p>
                            <p class="text-lg font-bold text-blue-600 dark:text-blue-400"
                               x-text="weeklyLoadPatterns.business_summary?.business_days?.total_instances?.toLocaleString()"></p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Weekend Load</p>
                            <p class="text-lg font-bold text-purple-600 dark:text-purple-400"
                               x-text="weeklyLoadPatterns.business_summary?.weekends?.total_instances?.toLocaleString()"></p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Weekend vs
                                Business</p>
                            <p class="text-lg font-bold"
                               :class="{
                                               'text-green-600 dark:text-green-400': weeklyLoadPatterns.business_summary?.weekend_vs_business?.direction === 'faster',
                                               'text-yellow-600 dark:text-yellow-400': weeklyLoadPatterns.business_summary?.weekend_vs_business?.direction === 'similar',
                                               'text-red-600 dark:text-red-400': weeklyLoadPatterns.business_summary?.weekend_vs_business?.direction === 'slower'
                                           }"
                               x-text="weeklyLoadPatterns.business_summary?.weekend_vs_business?.change_pct?.toFixed(1) + '%'"></p>
                        </div>
                    </div>
                </div>

                <!-- Weekday Bar Chart -->
                <div class="mb-4">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Load
                        Distribution by Day</h4>
                    <div class="space-y-2">
                        <template x-for="day in weeklyLoadPatterns.daily_patterns"
                                  :key="day.day_of_week">
                            <div class="flex items-center gap-3">
                                <!-- Day Name -->
                                <div class="w-24 text-right">
                                                <span class="text-sm font-medium text-gray-900 dark:text-gray-100"
                                                      x-text="day.day_name"></span>
                                    <span x-show="day.is_weekend"
                                          class="ml-1 text-xs px-1 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded">Weekend</span>
                                </div>

                                <!-- Bar Chart -->
                                <div class="flex-1 relative">
                                    <!-- Background bar -->
                                    <div class="w-full h-8 bg-gray-100 dark:bg-gray-700 rounded overflow-hidden">
                                        <!-- Filled bar -->
                                        <div class="h-full rounded transition-all duration-500"
                                             :class="day.is_weekend ? 'bg-gradient-to-r from-purple-500 to-purple-600' : 'bg-gradient-to-r from-blue-500 to-blue-600'"
                                             :style="`width: ${(day.total_instances / Math.max(...weeklyLoadPatterns.daily_patterns.map(d => d.total_instances))) * 100}%`">
                                        </div>
                                    </div>
                                    <!-- Value label -->
                                    <div class="absolute inset-0 flex items-center px-3">
                                                    <span class="text-sm font-bold text-white drop-shadow-md"
                                                          x-text="day.total_instances.toLocaleString() + ' instances'"></span>
                                    </div>
                                </div>

                                <!-- Percentage -->
                                <div class="w-16 text-right">
                                                <span class="text-xs font-semibold text-gray-600 dark:text-gray-400"
                                                      x-text="((day.total_instances / weeklyLoadPatterns.daily_patterns.reduce((sum, d) => sum + d.total_instances, 0)) * 100).toFixed(1) + '%'"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Peak Hours -->
                <template
                        x-if="weeklyLoadPatterns.business_summary?.peak_hours && weeklyLoadPatterns.business_summary.peak_hours.length > 0">
                    <div class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                        <h4 class="text-sm font-semibold text-yellow-700 dark:text-yellow-300 mb-2 flex items-center">
                            <i data-lucide="clock" class="h-4 w-4 mr-1"></i>
                            Top Peak Hours
                        </h4>
                        <div class="flex flex-wrap gap-2">
                            <template
                                    x-for="(peak, idx) in weeklyLoadPatterns.business_summary.peak_hours.slice(0, 5)"
                                    :key="idx">
                                <div class="px-3 py-1 rounded-full text-xs font-medium"
                                     :class="peak.is_business_hours ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'">
                                    <span x-text="peak.hour + ':00'"></span>
                                    <span class="ml-1 font-bold"
                                          x-text="'(' + peak.instances.toLocaleString() + ')'"></span>
                                    <span x-show="peak.is_business_hours" class="ml-1">ðŸ’¼</span>
                                    <span x-show="!peak.is_business_hours" class="ml-1">ðŸŒ™</span>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

                <!-- Recommendations -->
                <template
                        x-if="weeklyLoadPatterns.business_summary?.recommendations && weeklyLoadPatterns.business_summary.recommendations.length > 0">
                    <div class="mt-4">
                        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                            <i data-lucide="lightbulb" class="h-4 w-4 mr-1 text-green-600"></i>
                            Scheduling Recommendations
                        </h4>
                        <div class="space-y-2">
                            <template
                                    x-for="(rec, recIdx) in weeklyLoadPatterns.business_summary.recommendations.slice(0, 3)"
                                    :key="recIdx">
                                <div class="p-2 bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500 rounded text-sm text-gray-700 dark:text-gray-300">
                                    <span x-text="rec.message || rec"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </template>
    </div>

    <!-- NEW: Critical Insights Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-6"
         x-intersect.once="!criticalInsights && !criticalInsightsLoading && loadCriticalInsights()">
        <div class="flex items-center justify-between mb-4">
            <div class="font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                <i data-lucide="alert-octagon"
                   class="mr-2 h-5 w-5 text-red-600 dark:text-red-400"></i>
                <span>Critical Insights & Recommendations</span>
                <span class="group relative ml-2">
                                <i data-lucide="info" class="h-4 w-4 text-gray-400 cursor-help"></i>
                                <span class="hidden group-hover:block absolute left-0 top-6 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl z-50">
                                    Automated detection of critical issues with actionable recommendations. Includes specific instance IDs, business keys, and ROI estimates for immediate action.
                                </span>
                            </span>
                <span class="ml-2 text-xs px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded-full font-semibold">
                                ACTIONABLE ALERTS
                            </span>
            </div>
            <button @click="loadCriticalInsights()"
                    :disabled="criticalInsightsLoading"
                    class="inline-flex items-center px-4 py-2 border border-red-300 dark:border-red-600 shadow-sm text-sm font-medium rounded-md text-red-700 dark:text-red-300 bg-white dark:bg-gray-800 hover:bg-red-50 dark:hover:bg-red-900/30 disabled:opacity-50">
                <i data-lucide="refresh-cw" class="h-4 w-4 mr-2"
                   :class="{ 'animate-spin': criticalInsightsLoading }"></i>
                <span x-text="criticalInsightsLoading ? 'Loading...' : 'Refresh'"></span>
            </button>
        </div>

        <template x-if="criticalInsightsLoading">
            <div class="flex flex-col items-center justify-center py-8">
                <div class="loader mb-2"></div>
                <p class="text-xs text-gray-600 dark:text-gray-400">Generating insights...</p>
            </div>
        </template>

        <template x-if="criticalInsights && !criticalInsightsLoading">
            <div>
                <!-- Summary Dashboard -->
                <div class="mb-4 grid grid-cols-4 gap-3">
                    <div class="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-center">
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Critical Issues</p>
                        <p class="text-2xl font-bold text-red-600 dark:text-red-400"
                           x-text="criticalInsights.summary?.critical_issues || 0"></p>
                    </div>
                    <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg text-center">
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Warnings</p>
                        <p class="text-2xl font-bold text-yellow-600 dark:text-yellow-400"
                           x-text="criticalInsights.summary?.warnings || 0"></p>
                    </div>
                    <div class="p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg text-center">
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Optimizations</p>
                        <p class="text-2xl font-bold text-blue-600 dark:text-blue-400"
                           x-text="criticalInsights.summary?.optimization_opportunities || 0"></p>
                    </div>
                    <div class="p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg text-center">
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Potential
                            Savings</p>
                        <p class="text-2xl font-bold text-green-600 dark:text-green-400"
                           x-text="(criticalInsights.summary?.total_potential_savings_hours || 0).toFixed(0) + 'h'"></p>
                    </div>
                </div>

                <!-- Critical Alerts -->
                <div class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                    <!-- Version Regressions -->
                    <template
                            x-if="criticalInsights.version_regressions && criticalInsights.version_regressions.length > 0">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                <i data-lucide="git-branch" class="h-4 w-4 mr-1 text-red-600"></i>
                                Version Regressions
                            </h4>
                            <template x-for="reg in criticalInsights.version_regressions"
                                      :key="reg.process_key">
                                <div class="p-3 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-600 rounded mb-2">
                                    <p class="font-medium text-gray-900 dark:text-gray-100 mb-1"
                                       x-text="reg.process_key"></p>
                                    <p class="text-sm text-red-700 dark:text-red-300 mb-2"
                                       x-text="reg.recommendation"></p>
                                    <div class="flex flex-wrap gap-2 text-xs">
                                        <template x-for="action in reg.actions" :key="action">
                                                        <span class="px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded"
                                                              x-text="'â€¢ ' + action"></span>
                                        </template>
                                    </div>
                                    <div x-show="reg.sample_instance_id"
                                         class="mt-2 text-xs bg-white dark:bg-gray-800 p-2 rounded">
                                        <code x-text="reg.sample_instance_id + ' | ' + (reg.sample_business_key || 'N/A')"></code>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Stuck Instances -->
                    <template
                            x-if="criticalInsights.stuck_instances && criticalInsights.stuck_instances.length > 0">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                <i data-lucide="clock" class="h-4 w-4 mr-1 text-yellow-600"></i>
                                Stuck Process Alerts
                            </h4>
                            <template x-for="stuck in criticalInsights.stuck_instances"
                                      :key="stuck.process_key">
                                <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-600 rounded mb-2">
                                    <p class="font-medium text-gray-900 dark:text-gray-100 mb-1"
                                       x-text="stuck.process_key"></p>
                                    <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-2"
                                       x-text="stuck.recommendation"></p>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mb-2">
                                        Oldest: <strong
                                            x-text="stuck.oldest_days.toFixed(0) + ' days'"></strong>
                                        |
                                        Total stuck: <strong x-text="stuck.stuck_count"></strong>
                                    </div>
                                    <div class="flex flex-wrap gap-2 text-xs">
                                        <template x-for="action in stuck.actions" :key="action">
                                                        <span class="px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded"
                                                              x-text="'â€¢ ' + action"></span>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Activity Targets -->
                    <template
                            x-if="criticalInsights.activity_targets && criticalInsights.activity_targets.length > 0">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                <i data-lucide="target" class="h-4 w-4 mr-1 text-green-600"></i>
                                Top Optimization Targets
                            </h4>
                            <template x-for="target in criticalInsights.activity_targets"
                                      :key="target.rank">
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 border-l-4 border-green-600 rounded mb-2">
                                    <div class="flex items-start justify-between mb-2">
                                        <div class="flex-1">
                                            <p class="font-medium text-gray-900 dark:text-gray-100"
                                               x-text="'#' + target.rank + ' - ' + target.process_key"></p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400"
                                               x-text="target.activity_name + ' (' + target.activity_type + ')'"></p>
                                        </div>
                                        <span class="text-sm font-bold text-green-600 dark:text-green-400"
                                              x-text="target.potential_savings_hours.toFixed(0) + 'h savings'"></span>
                                    </div>
                                    <p class="text-sm text-green-700 dark:text-green-300 mb-2"
                                       x-text="target.recommendation"></p>
                                    <div class="flex flex-wrap gap-2 text-xs">
                                        <template x-for="action in target.actions" :key="action">
                                                        <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded"
                                                              x-text="'â€¢ ' + action"></span>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Load Optimizations -->
                    <template
                            x-if="criticalInsights.load_optimizations && criticalInsights.load_optimizations.length > 0">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                <i data-lucide="trending-up" class="h-4 w-4 mr-1 text-blue-600"></i>
                                Load Pattern Optimizations
                            </h4>
                            <template x-for="opt in criticalInsights.load_optimizations"
                                      :key="opt.type">
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-600 rounded mb-2">
                                    <p class="text-sm text-blue-700 dark:text-blue-300 mb-2"
                                       x-text="opt.recommendation"></p>
                                    <div class="flex flex-wrap gap-2 text-xs">
                                        <template x-for="action in opt.actions" :key="action">
                                                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded"
                                                              x-text="'â€¢ ' + action"></span>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Extreme Variability Warnings -->
                    <template
                            x-if="criticalInsights.extreme_variability && criticalInsights.extreme_variability.length > 0">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                <i data-lucide="alert-triangle"
                                   class="h-4 w-4 mr-1 text-orange-600"></i>
                                Extreme Variability Warnings
                            </h4>
                            <template x-for="varItem in criticalInsights.extreme_variability"
                                      :key="varItem.process_key">
                                <div class="p-3 bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-600 rounded mb-2">
                                    <p class="font-medium text-gray-900 dark:text-gray-100 mb-1"
                                       x-text="varItem.process_key"></p>
                                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">
                                        P95 is <strong
                                            x-text="varItem.ratio.toFixed(0) + 'x'"></strong> the
                                        median
                                        (<span
                                            x-text="formatDuration(varItem.median_s * 1000)"></span>
                                        â†’
                                        <span x-text="formatDuration(varItem.p95_s * 1000)"></span>)
                                    </p>
                                    <p class="text-sm text-orange-700 dark:text-orange-300 mb-2"
                                       x-text="varItem.recommendation"></p>
                                    <div class="flex flex-wrap gap-2 text-xs">
                                        <template x-for="action in varItem.actions" :key="action">
                                                        <span class="px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 rounded"
                                                              x-text="'â€¢ ' + action"></span>
                                        </template>
                                    </div>
                                    <div x-show="varItem.sample_instance_id"
                                         class="mt-2 text-xs bg-white dark:bg-gray-800 p-2 rounded">
                                        <code x-text="varItem.sample_instance_id + ' | ' + (varItem.sample_business_key || 'N/A')"></code>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Outlier Warnings -->
                    <template
                            x-if="criticalInsights.outlier_warnings && criticalInsights.outlier_warnings.length > 0">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                <i data-lucide="activity" class="h-4 w-4 mr-1 text-purple-600"></i>
                                Outlier-Heavy Processes
                            </h4>
                            <template x-for="outlier in criticalInsights.outlier_warnings"
                                      :key="outlier.process_key">
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-600 rounded mb-2">
                                    <p class="font-medium text-gray-900 dark:text-gray-100 mb-1"
                                       x-text="outlier.process_key"></p>
                                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">
                                        <strong x-text="outlier.outlier_pct.toFixed(1) + '%'"></strong>
                                        outliers
                                        (<span x-text="outlier.outlier_count"></span> of <span
                                            x-text="outlier.total_count"></span>)
                                    </p>
                                    <p class="text-sm text-purple-700 dark:text-purple-300 mb-2"
                                       x-text="outlier.recommendation"></p>
                                    <div class="flex flex-wrap gap-2 text-xs">
                                        <template x-for="action in outlier.actions" :key="action">
                                                        <span class="px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded"
                                                              x-text="'â€¢ ' + action"></span>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
        </template>
    </div>
</div>